# Connecteur pour la gestion des utilisateurs et des autorisations
name: auth-connector
description: Gestion des utilisateurs et des autorisations
version: 1.0.0

# Dépendances du connecteur
requires:
  - firebase-auth

# Configuration du connecteur
config:
  # Activer la validation des jetons JWT
  validateTokens: true
  
  # Règles d'autorisation par défaut
  defaultRules:
    read: true  # Autoriser la lecture par défaut
    write: false  # Refuser l'écriture par défaut

# Définition des rôles et permissions
roles:
  - id: admin
    name: Administrateur
    permissions:
      - "*"  # Accès complet

  - id: manager
    name: Gestionnaire
    permissions:
      - "models:read"
      - "models:write"
      - "castings:read"
      - "castings:write"
      - "bookings:read"
      - "bookings:write"

  - id: model
    name: Modèle
    permissions:
      - "profile:read"
      - "profile:write"
      - "applications:read"
      - "applications:write"
      - "bookings:read"

  - id: client
    name: Client
    permissions:
      - "castings:read"
      - "bookings:read"
      - "bookings:write"

# Hooks pour les événements utilisateur
hooks:
  # Après la création d'un utilisateur
  afterUserCreate:
    handler: ./handlers/afterUserCreate.js
  
  # Avant la suppression d'un utilisateur
  beforeUserDelete:
    handler: ./handlers/beforeUserDelete.js

# Configuration de la journalisation
logging:
  level: info
  format: json
  
  # Journalisation des événements sensibles
  sensitiveOperations: true
  
  # Rétention des journaux (en jours)
  retentionDays: 30

# Configuration de la sécurité
security:
  # Exiger une authentification forte pour les rôles sensibles
  requireMfa: true
  
  # Durée de vie des sessions (en secondes)
  sessionLifetime: 86400  # 24 heures
  
  # Politique de mot de passe
  passwordPolicy:
    minLength: 8
    requireUppercase: true
    requireLowercase: true
    requireNumbers: true
    requireSpecialChars: true

# Configuration des notifications
notifications:
  # Activer les notifications par email
  email:
    enabled: true
    
    # Modèles d'emails
    templates:
      welcome:
        subject: "Bienvenue sur Parfait Louis Asseko"
        template: "./templates/emails/welcome.html"
      
      passwordReset:
        subject: "Réinitialisation de votre mot de passe"
        template: "./templates/emails/password-reset.html"

# Configuration de l'API
api:
  # Activer les points de terminaison REST
  rest:
    enabled: true
    
  # Activer GraphQL
  graphql:
    enabled: true
    
  # Activer les abonnements en temps réel
  subscriptions:
    enabled: true

# Configuration du cache
caching:
  enabled: true
  ttl: 300  # 5 minutes
  
  # Stratégie de cache
  strategy: lru
  
  # Taille maximale du cache
  maxSize: 100MB

# Configuration des limites de taux
rateLimiting:
  enabled: true
  
  # Limites par défaut
  default:
    window: 60  # secondes
    max: 100    # requêtes
  
  # Limites spécifiques aux points de terminaison sensibles
  endpoints:
    login:
      window: 300
      max: 5
    
    passwordReset:
      window: 3600
      max: 3

# Configuration du débogage
debug:
  enabled: false
  
  # Niveau de débogage
  level: debug
  
  # Activer les requêtes SQL brutes
  showQueries: false

# Configuration du déploiement
deployment:
  # Variables d'environnement
  env:
    - name: NODE_ENV
      value: production
    
    - name: LOG_LEVEL
      value: info
  
  # Ressources allouées
  resources:
    cpu: 1
    memory: 1Gi
    
  # Mise à l'échelle automatique
  autoscaling:
    minInstances: 1
    maxInstances: 5
    targetCpuUtilization: 60

# Configuration des tests
test:
  # Activer les tests automatisés
  enabled: true
  
  # Répertoire des tests
  directory: ./tests
  
  # Configuration des données de test
  fixtures:
    enabled: true
    directory: ./tests/fixtures

# Documentation
documentation:
  enabled: true
  
  # Format de la documentation
  format: openapi
  
  # Emplacement du fichier de documentation
  path: ./docs/openapi.yaml

# Configuration des métriques
metrics:
  enabled: true
  
  # Fournisseur de métriques
  provider: prometheus
  
  # Fréquence d'échantillonnage
  samplingRate: 1.0

# Configuration du suivi des erreurs
errorTracking:
  enabled: true
  
  # Fournisseur de suivi des erreurs
  provider: sentry
  
  # Niveau de rapport
  level: error

# Configuration de la sauvegarde
backup:
  # Activer les sauvegardes automatiques
  enabled: true
  
  # Planification des sauvegardes (format cron)
  schedule: "0 2 * * *"  # Tous les jours à 2h du matin
  
  # Rétention des sauvegardes (en jours)
  retentionDays: 30

# Configuration de la mise à jour automatique
autoUpdate:
  # Activer les mises à jour automatiques
  enabled: true
  
  # Planification des vérifications de mises à jour
  schedule: "0 3 * * *"  # Tous les jours à 3h du matin
  
  # Stratégie de mise à jour
  strategy: patch  # Mettre à jour uniquement les correctifs de sécurité et les corrections de bogues
