# Connecteur pour le stockage de fichiers
name: storage-connector
description: Gestion du stockage des fichiers et médias
version: 1.0.0

# Dépendances
requires:
  - @google-cloud/storage

# Configuration du stockage
config:
  # Fournisseur de stockage (gcs, aws-s3, azure-blob, local)
  provider: gcs
  
  # Configuration spécifique au fournisseur
  gcs:
    bucket: "${STORAGE_BUCKET}"
    projectId: "${PROJECT_ID}"
    keyFilename: "./service-account.json"
  
  # Taille maximale des fichiers (en octets)
  maxFileSize: 10485760  # 10MB
  
  # Types MIME autorisés
  allowedMimeTypes:
    - "image/jpeg"
    - "image/png"
    - "image/gif"
    - "application/pdf"
    - "application/msword"
    - "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
  
  # Politique de rétention des fichiers (en jours)
  retentionDays: 365
  
  # Activer la suppression sécurisée
  secureDelete: true

# Hooks pour les événements de stockage
hooks:
  # Après le téléversement d'un fichier
  afterFileUpload:
    handler: ./handlers/afterFileUpload.js
    
  # Avant la suppression d'un fichier
  beforeFileDelete:
    handler: ./handlers/beforeFileDelete.js

# Configuration de la sécurité
security:
  # Activer la signature des URLs
  signedUrls: true
  
  # Durée de validité des URLs signées (en secondes)
  signedUrlExpiry: 3600  # 1 heure
  
  # Activer le contrôle d'accès basé sur les rôles
  rbac: true
  
  # Règles d'accès par défaut
  defaultAcl: "projectPrivate"

# Configuration du cache
caching:
  enabled: true
  ttl: 86400  # 24 heures
  
  # Stratégie de cache
  strategy: lru
  
  # Taille maximale du cache
  maxSize: "1GB"

# Configuration des métriques
metrics:
  enabled: true
  
  # Métriques à collecter
  collect:
    fileUploads: true
    fileDownloads: true
    storageUsage: true
    operationLatency: true

# Configuration des notifications
notifications:
  # Activer les notifications
  enabled: true
  
  # Types de notifications
  types:
    - fileUploaded
    - fileDeleted
    - storageQuotaWarning
  
  # Destinataires des notifications
  recipients:
    - admin@parfaitlouisasseko.com

# Configuration des transformations d'images
imageProcessing:
  # Activer le traitement d'images
  enabled: true
  
  # Qualité par défaut (0-100)
  defaultQuality: 85
  
  # Formats de sortie pris en charge
  supportedFormats:
    - original
    - webp
    - jpeg
    - png
  
  # Tailles prédéfinies
  sizes:
    thumbnail:
      width: 150
      height: 150
      crop: true
    
    medium:
      width: 800
      height: 600
      fit: "inside"
    
    large:
      width: 1920
      height: 1080
      fit: "inside"

# Configuration du nettoyage automatique
autoCleanup:
  # Activer le nettoyage automatique
  enabled: true
  
  # Planification (format cron)
  schedule: "0 3 * * *"  # Tous les jours à 3h du matin
  
  # Fichiers temporaires plus anciens que (en jours)
  deleteTempOlderThan: 1
  
  # Fichiers orphelins plus anciens que (en jours)
  deleteOrphanedOlderThan: 30

# Configuration des quotas
quotas:
  # Activer les quotas
  enabled: true
  
  # Quota d'espace disque par utilisateur (en octets)
  userStorageLimit: 1073741824  # 1GB
  
  # Quota de bande passante mensuelle (en octets)
  monthlyBandwidthLimit: 10737418240  # 10GB

# Configuration de la réplication
replication:
  # Activer la réplication
  enabled: false
  
  # Fournisseur de réplication
  provider: "gcs"
  
  # Configuration de la réplication
  config:
    destinationBucket: "${BACKUP_BUCKET}"
    syncDeletions: true

# Configuration de la restauration
disasterRecovery:
  # Activer la sauvegarde
  enabled: true
  
  # Planification des sauvegardes (format cron)
  backupSchedule: "0 2 * * *"  # Tous les jours à 2h du matin
  
  # Rétention des sauvegardes (en jours)
  retentionDays: 30
  
  # Activer le chiffrement des sauvegardes
  encryption: true

# Configuration de la migration
migration:
  # Activer la migration
  enabled: false
  
  # Stratégie de migration
  strategy: "zero-downtime"
  
  # Configuration de la migration
  config:
    sourceProvider: "local"
    destinationProvider: "gcs"

# Configuration des tests
testing:
  # Activer les tests
  enabled: true
  
  # Répertoire des tests
  testDirectory: "./test"
  
  # Données de test
  fixtures:
    enabled: true
    directory: "./test/fixtures"

# Configuration du débogage
debug:
  # Activer le mode débogage
  enabled: false
  
  # Niveau de journalisation
  level: "debug"
  
  # Activer les journaux détaillés
  verbose: false

# Configuration de la documentation
documentation:
  # Activer la documentation
  enabled: true
  
  # Format de la documentation
  format: "openapi"
  
  # Chemin de sortie
  output: "./docs/storage-api.yaml"

# Configuration des métadonnées
metadata:
  # Auteur
  author: "Équipe Parfait Louis Asseko"
  
  # Version
  version: "1.0.0"
  
  # Description
  description: "Connecteur de stockage pour l'application Parfait Louis Asseko"
  
  # Mots-clés
  keywords:
    - "stockage"
    - "fichiers"
    - "médias"
    - "gcs"
  
  # Licence
  license: "Propriétaire"
  
  # Lien vers le dépôt
  repository: "https://github.com/parfaitlouisasseko/parfait-louis-asseko"
  
  # Lien vers le suivi des problèmes
  bugs: "https://github.com/parfaitlouisasseko/parfait-louis-asseko/issues"
  
  # Lien vers la page d'accueil
  homepage: "https://parfaitlouisasseko.com"

# Configuration des variables d'environnement requises
requiredEnvVars:
  - STORAGE_BUCKET
  - PROJECT_ID
  - GOOGLE_APPLICATION_CREDENTIALS
