rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Configuration publique - Lecture seule pour tous, écriture pour admin
    match /config/{document} {
      allow read: true;
      allow write: if request.auth != null && 
                      (request.auth.token.admin == true || 
                       request.auth.uid == 'admin');
    }
    
    // Collections publiques - Lecture pour tous
    match /models/{modelId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /articles/{articleId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /fashionDayEvents/{eventId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /testimonials/{testimonialId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /newsItems/{newsId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /agencyServices/{serviceId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /courseData/{courseId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /faqData/{faqId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /heroSlides/{slideId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    // Collections de données agence
    match /modelDistinctions/{distinctionId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /agencyAchievements/{achievementId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /agencyPartners/{partnerId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /agencyTimeline/{timelineId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /navLinks/{linkId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    // Applications et demandes - Lecture/écriture authentifiée
    match /castingApplications/{applicationId} {
      allow read: if request.auth != null;
      allow create: true; // Permet aux visiteurs de postuler
      allow update, delete: if request.auth != null;
    }
    
    match /fashionDayApplications/{applicationId} {
      allow read: if request.auth != null;
      allow create: true; // Permet aux visiteurs de postuler
      allow update, delete: if request.auth != null;
    }
    
    match /bookingRequests/{requestId} {
      allow read: if request.auth != null;
      allow create: true; // Permet aux clients de faire des demandes
      allow update, delete: if request.auth != null;
    }
    
    match /contactMessages/{messageId} {
      allow read: if request.auth != null;
      allow create: true; // Permet aux visiteurs de contacter
      allow update, delete: if request.auth != null;
    }
    
    match /recoveryRequests/{requestId} {
      allow read: if request.auth != null;
      allow create: true; // Permet la récupération de compte
      allow update, delete: if request.auth != null;
    }
    
    // Forum - Lecture publique, écriture authentifiée
    match /forumThreads/{threadId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /forumReplies/{replyId} {
      allow read: true;
      allow write: if request.auth != null;
    }
    
    match /articleComments/{commentId} {
      allow read: true;
      allow create: true; // Permet aux visiteurs de commenter
      allow update, delete: if request.auth != null;
    }
    
    // Données sensibles - Admin uniquement
    match /juryMembers/{juryId} {
      allow read, write: if request.auth != null && 
                            request.auth.token.admin == true;
    }
    
    match /registrationStaff/{staffId} {
      allow read, write: if request.auth != null && 
                            request.auth.token.admin == true;
    }
    
    match /absences/{absenceId} {
      allow read, write: if request.auth != null;
    }
    
    match /monthlyPayments/{paymentId} {
      allow read, write: if request.auth != null;
    }
    
    match /photoshootBriefs/{briefId} {
      allow read, write: if request.auth != null;
    }
    
    // Règle par défaut pour les nouvelles collections
    match /{document=**} {
      allow read: true;
      allow write: if request.auth != null;
    }
  }
}
